name: 🚀 Deploy to Server

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout del código
        uses: actions/checkout@v3

      - name: 🚀 Desplegar en servidor
        run: |
          ssh -v -o StrictHostKeyChecking=no deploy@tl-showroom.equalitech.xyz << 'EOF'
            mkdir -p /opt/easyengine/sites/tl-showroom.equalitech.xyz/app/backend
            cd /opt/easyengine/sites/tl-showroom.equalitech.xyz/app/backend

            if [ ! -d ".git" ]; then
              echo "⚠️ Repo no clonado, clonando ahora..."
              git clone git@github.com:jupahefi/.git .
            else
              echo "📥 Repo ya clonado, actualizando..."
              git pull origin main
            fi

            echo "🚀 Ejecutando deploy..."
            bash deploy.sh

            echo "✅ Despliegue completado!"
          EOF
